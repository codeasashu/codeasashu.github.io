<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>Creating XMPP chat server - Ashutosh Chaudhary</title>
        <meta name="author" content="Ashutosh Chaudhary" />
        <meta name="description" content="Creating XMPP chat server" />
        <meta name="keywords" content="Creating XMPP chat server, Ashutosh Chaudhary, Uncategorized" />

        <meta content="1159707894060864" property="fb:app_id">
        <meta content="Ashutosh Chaudhary" property="og:site_name">
        
          <meta content="Creating XMPP chat server" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="My Personal Blog" property="og:description">
        
        
          <meta content="http://aboutashu.com/xmpp-chat-server/" property="og:url">
        
        
          <meta content="2016-04-30T15:32:06+05:30" property="article:published_time">
          <meta content="http://aboutashu.com/about/" property="article:author">
        
        
          <meta content="http://aboutashu.com/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="Uncategorized" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@216ashutosh">
        <meta name="twitter:creator" content="@216ashutosh">
        
          <meta name="twitter:title" content="Creating XMPP chat server">
        
        
          <meta name="twitter:url" content="http://aboutashu.com/xmpp-chat-server/">
        
        
          <meta name="twitter:description" content="My Personal Blog">
        
        

        <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Bootstrap core CSS -->
        <link href="/static/css/bootstrap.min.css" rel="stylesheet">

        <!-- Fonts -->
        <link href="//fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">


        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/super-search.css">
        <link rel="stylesheet" href="/static/css/projects.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72862926-1', 'auto');
  ga('send', 'pageview');

</script>
    </head>

    <body>
        <div class="container">
            <div class="col-sm-3">
                <a href="/"><img id="about" src="/static/img/avatar.jpg" height="75px" width="75px" /></a>
                <h1 class="author-name">Ashutosh Chaudhary</h1>
                
                <div id="about">
                    Freelance web, apps developer
                </div>
                

                <div class="social">
	<ul>
		
			<li><a href="http://facebook.com/ashutosh2k12" target="_blank"><i class="fa fa-facebook"></i></a></li>
		
			<li><a href="skype:ashu2k111" target="_blank"><i class="fa fa-skype"></i></a></li>
		
			<li><a href="http://twitter.com/216ashutosh" target="_blank"><i class="fa fa-twitter"></i></a></li>
		
			<li><a href="https://in.linkedin.com/in/codeasashu" target="_blank"><i class="fa fa-linkedin"></i></a></li>
		
			<li><a href="http://stackexchange.com/users/1155850/ashutosh" target="_blank"><i class="fa fa-stack-exchange"></i></a></li>
		
	</ul>
</div>
               
                <div class="search" id="js-search">
                  <input type="text" placeholder="(sitemap)~$ type to search" class="search__input form-control" id="js-search__input">
                  <ul class="search__results" id="js-search__results"></ul>
                </div>
                <hr />
                <div class="navigation">
                <strong>Navigation</strong><br />
                    &raquo; <a href="/">Home</a> <br />
                
                    &raquo; <a class="about" href="/about/">About Me</a><br />
                
                    &raquo; <a class="about" href="/projects/">Projects</a><br />
                
                    &raquo; <a class="about" href="https://drive.google.com/file/d/0B3Xfz0jTV0TnSjlMRS1DNGlSaTlxaHBEZHdoaGZWd1Q1Wkpn/view?usp=sharing">Resume</a><br />
                
                    &raquo; <a class="about" href="https://github.com/ashutosh2k12">Github</a><br />
                
                    &raquo; <a class="about" href="/feed.xml">XML Feed</a><br />
                
                </div>
            </div>

            <div class="col-sm-8 col-offset-1">
                







<h1>Creating XMPP chat server</h1>
<span class="time">30 Apr 2016</span>

<span class="categories">
    &raquo; <a href="/category/Uncategorized">Uncategorized</a>
</span>


<span class="part-series">
    &raquo; This posts is part of series -  <a href="http://aboutashu.com/implement-xmpp-chat-client-android/">Implement XMPP chat client in Android</a>  
</span>


<div class="content">
    <div class="post"><p>In this part of series, I am going to show you how to create an XMPP chat server.</p>

<p>To build your own XMPP based chat solution in android, you need to have two important things:</p>

<ol>
  <li>XMPP based chat server</li>
  <li>XMPP integration in your android code</li>
</ol>

<p>XMPP chat server or XMPP server is the one that handles chat database, configurations, user, options etc. Basically, it is a chat server that handles your chat backend. What remains is to implement the chat in your own language and have fun.</p>

<p>There are many variations of XMPP chat servers available today. You can use any of them depending on your requirements and available configurations. What I would recommend are <a href="http://www.igniterealtime.org/projects/openfire/">openfire</a> and <a href="https://www.ejabberd.im/">ejabberd</a>.</p>

<p>Personally, I am going to use ejabberd to setup XMPP chat server. Let’s get into action. First, you will need a web server.For now, I am using <a href="https://www.digitalocean.com">DigitalOcean VPS</a> with Ubuntu Server 14.04 LTS installed, to host the server. Don’t worry if you do not have a VPS right now. You can still test it with your own localhost machine.</p>

<h2 id="installing-ejabberd">Installing Ejabberd</h2>

<p>Run following command in your terminal to update current package list.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo apt-get update
</code></pre>
</div>

<p>To install <strong>ejabberd</strong>, just enter the below command and you are done. So easy.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo apt-get -y install ejabberd
</code></pre>
</div>

<p>This will install ejabberd and will also create a configuration file which you can edit to have your own jabberd configuration. The ejabberd configuration file can be found at <code class="highlighter-rouge">/etc/ejabberd/ejabberd.cfg</code>. Lets edit it. Back on your terminal screen, enter this command to edit the file:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo nano /etc/ejabberd/ejabberd.cfg
</code></pre>
</div>

<p>This will bring up <code class="highlighter-rouge">nano</code> editor, where you can use up and down keys on your keyboard to edit the file. For Ubuntu desktops or other graphical environments, you can use <code class="highlighter-rouge">gedit</code>. Hence, use this command instead <code class="highlighter-rouge">sudo gedit /etc/ejabberd/ejabberd.cfg</code></p>

<p>In the editor screen, You’ll see a lot of text there and lot of options. Don’t panic. You only have edit 3-4 options overall. I will be doing them below, so pay attention.</p>

<p>The ejabberd.cfg file will look something like this:</p>

<p><img src="/assets/ejabberd_cfg.png" alt="ejabberd.cfg" /></p>

<p>Use your cursor to move below and find the line which has this text:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%% Admin user
{acl, admin, {user, "admin", "localhost"}}.

%% Hostname
{hosts, ["localhost"]}.
</code></pre>
</div>

<p>Lets decode what’s written line by line so that you can get confortable enough to do this on your own next time.</p>

<p><strong>Admin user</strong> defines what user (user must be registered with ejabberd) holds the administrative privilages of ejabberd server. <code class="highlighter-rouge"><span class="p">{</span><span class="err">acl,</span><span class="w"> </span><span class="err">admin,</span><span class="w"> </span><span class="err">{user,</span><span class="w"> </span><span class="nt">"admin"</span><span class="err">,</span><span class="w"> </span><span class="nt">"localhost"</span><span class="err">}}.</span></code> This line tells that user with username <strong>admin@localhost</strong> is admin of ejabberd configuration. We can add multiple users here to make them admin. Let’s add one. So, press enter key and add similar line with different username.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">acl,</span><span class="w"> </span><span class="err">admin,</span><span class="w"> </span><span class="err">{user,</span><span class="w"> </span><span class="nt">"myusername"</span><span class="err">,</span><span class="w"> </span><span class="nt">"localhost"</span><span class="err">}}.</span><span class="w">
</span></code></pre>
</div>

<p>The file will now look like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%% Admin user
{acl, admin, {user, "admin", "localhost"}}.
{acl, admin, {user, "myusername", "localhost"}}.

%% Hostname
{hosts, ["localhost"]}.
</code></pre>
</div>

<p>You might be wondering the user “myusername” isn’t yet registered with ejabberd, how come we defined here. We will registered him shortly after we are done with editing configuration file.</p>

<p><strong>Hostname</strong> defines the server at which ejabberd should listen and connect. If you are not using a local machine (i.e you are using VPS such as DigitalOcean) to host the XMPP chat server, you can mention the domain name or IP address here. I am assuming example.com as my VPS domain name, hence I will modify this line as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">hosts,</span><span class="w"> </span><span class="err">[</span><span class="nt">"localhost"</span><span class="err">,</span><span class="nt">"example.com"</span><span class="err">]}.</span><span class="w">
</span></code></pre>
</div>

<p>Thats all the changes you have to make for now. Wasn’t that simple?
Once you have made the above changes, the cfg file will now look like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%% Options which are set by Debconf and managed by ucf

%% Admin user
{acl, admin, {user, "admin", "localhost"}}.
{acl, admin, {user, "myusername", "localhost"}}

%% Hostname 
{hosts, ["localhost","example.com"]}. 
</code></pre>
</div>

<p>Now exit the nano editor by pressing CTRL + X. This will prompt you if you want to overwrite the previous cfg file, press <strong>Y</strong>, then press Enter again to confirm. This will bring you back to terminal screen.</p>

<p>We have mentioned that “myusername” is another user holding administrative rights to ejabberd, but we still haven’t registered him yet. Lets register him as well. Enter following command to register:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ejabberdctl register myusername localhost password
</code></pre>
</div>

<p>Replace “password” with whatever password you want to use to login. Once you are done with this, You have to re-start your ejabberd server by issuing this command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo service ejabberd restart
</code></pre>
</div>

<p>Congradulations, We have successfully setup our ejabberd chat server. Lets visit the administrative control panel and see what we got there. Fire up your public domain name in your favorite browser on port 5280 to login to ejabberd server: http://example.com:5280 .This will bring up webpage asking you for username and password. Login with username: myusername@localhost, password: whatever you mentioned earlier.</p>

<p><strong>NOTE</strong>- The <em>localhost</em> in above username <em>myusername@localhost</em> represents domain name of user. If you are not sure, edit <em>ejabberd.cfg</em> and check for user. The line, for “myusername” looks like <code class="highlighter-rouge"><span class="p">{</span><span class="err">acl,</span><span class="w"> </span><span class="err">admin,</span><span class="w"> </span><span class="err">{user,</span><span class="w"> </span><span class="nt">"myusername"</span><span class="err">,</span><span class="w"> </span><span class="nt">"localhost"</span><span class="err">}}</span></code>, the last part is domain name.</p>

<p><strong>EDIT</strong>- For users running on local machines, you can simple use http://localhost:5280. To find your locally accessible ip address, run following command (<code class="highlighter-rouge">ipconfig</code> for windows user):</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ifconfig
</code></pre>
</div>
<p>and look for address in the form <code class="highlighter-rouge">192.168.0.xxx</code>.</p>

<p>Once done, following screen will show up:</p>

<p><img src="https://assets.digitalocean.com/articles/community/eJabberdAdmin1.png" alt="ejabberd admin panel" /></p>

<p>You have now successfully installed ejabberd on your machine and can be used to connect to any XMPP based chat client. In the next post, you’ll learn how to implement XMPP chat client in android code. Have fun!!</p>

<p>Thanks for going threw entire long post. Please like and share if you like the article. Ask anything in comments below.</p>

<h3 id="troubleshooting">Troubleshooting:</h3>

<p>Sometimes, ejabberd might not open up in your browser and will give <code class="highlighter-rouge">Connection timed out</code> error. It usually happens if firewall is blocking ports on which ejabberd relies for communication stuffs. Usually those ports are 5222, 5269, 5280. You can try opening those ports like I did below:</p>

<ul>
  <li>Enter following commands in terminal:</li>
  <li>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>iptables -A INPUT -p tcp --dport 5222 -j ACCEPT
iptables -A INPUT -p tcp --dport 5269 -j ACCEPT
iptables -A INPUT -p tcp --dport 5280 -j ACCEPT
</code></pre>
    </div>
  </li>
  <li>Open up <code class="highlighter-rouge">/etc/hosts</code> file. <code class="highlighter-rouge">sudo nano /etc/hosts</code>  and add your domain name into it (assuming your public ip address is 123.123.10.210) :</li>
  <li>
    <div class="highlighter-rouge"><pre class="highlight"><code>123.123.10.210 example.com
</code></pre>
    </div>
  </li>
  <li>Allow ubuntu firewall</li>
  <li>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo ufw allow 5222
sudo ufw allow 5269
sudo ufw allow 5280
</code></pre>
    </div>
  </li>
</ul>

<p>This will open the ports and allow public connections, which should fix the issue.</p>
</div>

    
	 
    <hr />
    <div class="panel">
        <div class="panel-body">
        <h4> This posts is part of series -  <a href="http://aboutashu.com/implement-xmpp-chat-client-android/">Implement XMPP chat client in Android</a>   </h4>
        <ul id="post-series-list">
    
         <li> Creating XMPP chat server </li>       <li> <a href="http://aboutashu.com/implement-xmpp-chat-client-android-part-1/">Implement XMPP chat client in Android &#8211; Part 1</a> </li>  
     </ul> </div> </div> 


    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="216ashutosh">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="http://aboutashu.com/xmpp-chat-server/" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=1159707894060864";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</div>




    
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
                
                <div class="panel-body">
                <h4>Related Posts</h4>
                <ul>
                
                <li class="relatedPost">
                    <a href="http://aboutashu.com/implement-xmpp-chat-client-android/">Implement XMPP chat client in Android</a>
                    
                        (Categories: <a href="/category/Uncategorized">Uncategorized</a>)
                    
                </li>
                
                
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="http://aboutashu.com/implement-xmpp-chat-client-android-part-1/">Implement XMPP chat client in Android &#8211; Part 1</a>
                    
                        (Categories: <a href="/category/Uncategorized">Uncategorized</a>)
                    
                </li>
                
                
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    
        
            
        
    

    
    
        
            
        
    
        
            
        
    

    
    
        
            
        
    

    
    
        
            
        
    


    </ul>
    </div>


<div class="PageNavigation">
  
    <a class="prev" href="/get-video-links-from-coursera/">&laquo; Get video links from Coursera</a>
  
  
    <a class="next" href="/implement-xmpp-chat-client-android-part-1/">Implement XMPP chat client in Android &#8211; Part 1 &raquo;</a>
  
</div>


<div class="disqus-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* <![CDATA[ */

        var disqus_shortname = "aboutashu";
        var disqus_identifier = "http://aboutashu.com_Creating XMPP chat server";
        var disqus_title = "Creating XMPP chat server";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    /* ]]> */
    </script>
</div>

                <footer>
                    &copy; Ashutosh Chaudhary
                     
                    - <a href="https://github.com/ashutosh2k12">https://github.com/ashutosh2k12</a> - Powered by Jekyll.
                    
                </footer>
                <div align="center">
                    <!-- hcz-jekyll -->
                  <ins class="adsbygoogle"
                       style="display:block"
                       data-ad-client="ca-pub-0776433630785969"
                       data-ad-slot="9690958902"
                       data-ad-format="auto"></ins>
                  <script>
                  (adsbygoogle = window.adsbygoogle || []).push({});
                  </script>
                </div>
            </div><!-- end /.col-sm-8 -->
        </div><!-- end /.container -->

        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        <!--
        <script src="/static/js/jquery.min.js"></script>
        -->
        <script src="/static/js/thickbox-compressed.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script src="/static/js/super-search.js"></script>
        <script src="/static/js/main.js"></script>
        <script src="/static/js/projects.js"></script>
    </body>
</html>
